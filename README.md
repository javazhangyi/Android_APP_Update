# APP应用内升级(Android)


### 1. 为什么需要应用内升级?

- apk上架市场周期慢，无法回退
- 可以小规模实验以及试错(新功能实验，稳定性检测)
- 可以快速收敛版本(新功能覆盖，严重bug修复)

### 2. app中应用内升级的几种形式：

- 应用启动时静默检测，提示更新
- 用户手动在设置页，点击检测更新

### 3.app应用内升级的实现流程：

网络请求->返回结果->是否需要更新->弹框显示版本说明->确定下载->下载并通知用户进度->完整性(md5)检测->安装

------

### 网络模块的设计：

- 考虑通过接口隔离具体实现
- 使用okhttp完成接口实现,实现get请求，文件下载

### UI实现：

- 通过DialogFragment而不是直接使用Dialog
- 接入网络请求，进度回调

### 安装apk和一些细节处理:

- 用户下载过程中cancel，如何及时的取消请求，中断下载
- apk的完整性校验
- 为了方便演示，使用应用内部的cache文件夹，避免涉及到存储卡权限(Android Q限制)

### 适配：

- 应用内安装，涉及到文件uri的传递，需要进行适配(Android N FileProvider适配)
- 引入安装权限(Android O对应用安装进行的权限的检测)

- P上，默认不允许直接使用http的请求，需要更安全的https【清单文件中也可以配置直接使用明文传输】(Android P对http网络请求的约束)